#{extends 'main.html' /}
#{set title:'Home' /}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
</head>  
<body>

  <nav class="menu push-menu-left">
    <ul>
        <li><button class="close-menu">pin</button></li>
        <li><a href="feed.html">Home</a></li>
        <li><a href="#">Saved for Later</a></li>
        <li><a id="addChannel" href="#">Add content</a></li>
        <li><a href="#">All</a></li>        
        <li><a href="index.html">Main page</a></li>        
    </ul>
  </nav>

  <div id="wrapper">
    <div id="main">
        <div class="container">
            <h2 class="my-header">
                Featured
            </h2>
            <div class="container">
                <div class="row" id="top_three"/>
            </div>
            <a href="channel.html">
                <h2 class="my-header">
                    Channel1
                </h2>
            </a>
            <div id="list" class="row"/>
        </div>
    </div>
  </div>

<div class="modal fade" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 id="header" class="modal-title">Basic Modal</h4>
      </div>
      <div class="modal-body">
            <img id="picture" src="">
            <p id="text"></p>
            <p>
              <small><i>Posted on January 10, 2014</i></small>
            </p>
            <div class="social-likes">
              <div class="facebook" title="Поделиться ссылкой на Фейсбуке">Facebook</div>
              <div class="twitter" title="Поделиться ссылкой в Твиттере">Twitter</div>
              <div class="vkontakte" title="Поделиться ссылкой во Вконтакте">Вконтакте</div>
              <div class="plusone" title="Поделиться ссылкой в Гугл-плюсе">Google+</div>
            </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Mark as unread</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="addChannelModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 id="header" class="modal-title">Add channel</h4>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="exampleInputEmail1">Url</label>
          <input type="email" class="form-control" id="inputUrl" placeholder="Enter url">
        </div>
      </div>      
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="add">Add</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">

    $(document).on("click",".my-item", function(e) {
        $('#basicModal').modal('toggle');
        $('#picture').attr("src", $(this).find("img").attr("src"));
        $('#header').html($(this).find("h4").html());
        var children =  $(this).find("p").html();
        $('#text').html(children);
        //$('#text').html($(this).find("span").html());
    });

    var getItemsAction = #{jsAction @ItemsController.items(':page', ':lenght')/};

    $(document).ready(function() {
        $.get(
                getItemsAction({page: '1', lenght: '10'}),
                function( data ) {
                    var items = data.items;
                    var n = 0;
                    $.each(items, function(index, item) {
                        if (item.image != "") {
                            if (n < 3) {
                                $("#top_three").append(
                                        '<div class="col-xs-4">' +
                                                '<div class="my-item">' +
                                                    '<div class="thumbnail">' +
                                                        '<img src=' + item.image + ' class="media object" alt="">' +
                                                        '<h3>' + item.title + '</h3>' +
                                                        '<p class="description">' +
                                                            item.description +
                                                        '</p>' +
                                                    '</div>' +
                                                '</div>' +
                                        '</div>');
                                n++;
                            }
                            else {
                                $("#list").append(
                                        '<div class="col-xs-12">' +
                                            '<div class="my-item">' +
                                                '<div class="thumbnail">' +
                                                    '<img src=' + item.image + ' class="item-picture">' +
                                                    '<h3>' + item.title + '</h3>' +
                                                    '<span>' +
                                                        item.description +
                                                    '</span>' +
                                                '</div>' +
                                            '</div>' +
                                        '</div>');
                            }
                        }
                    });
                },
                "json"
        )
    })

    $("#add").click(function() {
        var newUrl = $("#inputUrl").val();
        alert(newUrl);
        var addChannel = #{jsRoute @Application.addChannel(':url') /}
            $.ajax({
                url: addChannel.url({url: newUrl}),
                type: addChannel.method
        });
    });

    $("#addChannel").click(function() {
        $('#addChannelModal').modal('toggle');
    })

    $(".my-item").on("click", function() {
      $('#basicModal').modal('toggle');
      $('#picture').attr("src", $(this).find("img").attr("src"));
      $('#header').html($(this).find("h4").html());
      var children =  $(this).find("p").children();
//        alert(children);
//      $('#text').appendChild($(this).find("p").children());
        $('#text').appendChild(children);
    })

</script>


  </body>
</html>